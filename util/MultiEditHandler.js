/*
 * Copyright (C) 2009-2019 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object"],function(B){"use strict";return B.extend("i2d.eam.order.manages1.util.MultiEditHandler",{_aFields:null,_oModel:null,_sDialogFragment:null,_sActionName:null,constructor:function(m,a,d){this._oModel=m;this._sActionName=a;this._sDialogFragment=d;var M=this._oModel.getMetaModel();this._aFields=M.getODataFunctionImport("EAM_OBJPG_MAINTENANCEORDER_SRV.EAM_OBJPG_MAINTENANCEORDER_SRV_Entities/"+this._sActionName).parameter.map(function(p){return p.name;});},showDialog:function(p,c){var t=this,e=p.getController().extensionAPI;var f=this._aFields.filter(function(F){return c.filter(function(s){return typeof s.getProperty(F)==="undefined";}).length>0;}),a;if(f.length){a=Promise.all(c.map(function(s){return new Promise(function(r,b){t._oModel.read(s.getPath(),{urlParameters:{$select:f.join()},success:r,error:b});});}));}else{a=Promise.resolve();}a.then(function(){var m,d=sap.ui.xmlfragment(p.getController().createId("MultiEditDialog"),t._sDialogFragment,jQuery.extend({},this,{afterDialogClosed:function(){p.removeDependent(d);d.destroy();},onOkPressed:function(){e.securedExecution(function(){return m.getAllUpdatedContexts().then(function(C){return t._invokeActionsForMassChange(t._sActionName,C,e);});},{dataloss:{popup:false}});d.close();},onCancelPressed:function(){d.close();}}));m=d.getContent()[0];p.addDependent(d);m.setContexts(c);d.open();});e.securedExecution(function(){return a;},{dataloss:{popup:false}});},_invokeActionsForMassChange:function(a,c,e){var C=[],m=this._oModel.getMetaModel(),f=m.getODataFunctionImport("EAM_OBJPG_MAINTENANCEORDER_SRV.EAM_OBJPG_MAINTENANCEORDER_SRV_Entities/"+a),E=m.getODataEntityType(f["sap:action-for"]),p=jQuery.map(f.parameter,function(v){if(E.key.propertyRef.filter(function(k){return k.name===v.name;}).length>0){return null;}return v.name;}),g=function(o){var d={};for(var i=0;i<p.length;i++){d[p[i]]=o.getProperty(p[i])||"";}return d;},G=function(d){var r={};for(var k in d){r[k]=d[k]===null?"":d[k];}return r;};for(var i in c){if(c.hasOwnProperty(i)){if(jQuery.isEmptyObject(c[i].data)){continue;}}C.push({context:c[i].context,data:jQuery.extend({},g(c[i].context),G(c[i].data))});}return this._splitActionInvocationForMassEdit(C,a,e);},_splitActionInvocationForMassEdit:function(c,a,e){var p=Promise.resolve();for(var i=0;i<c.length;i++){if(c[i]===null){continue;}var C=[c[i].context];for(var j=i+1;j<c.length;j++){if(jQuery.sap.equal(c[i].data,c[j].data)){C.push(c[j].context);c[j]=null;}}p=p.then(jQuery.proxy(e.invokeActions,e,"EAM_OBJPG_MAINTENANCEORDER_SRV.EAM_OBJPG_MAINTENANCEORDER_SRV_Entities/"+a,C,c[i].data)).catch(jQuery.noop);}return p;}});});
